---
layout: post
title: node框架的选择
author: Tower
date: '2019-02-01 00:00:00'
category: framework
summary: node框架的选择
thumbnail: 180201framework.png
---

## 契机

入职小半年接手了一个全新项目，由于对旧的node项目有诸多的不满意，也发现了团队在使用node的过程中，有很多不足。
所以乘着新项目启动，决定选择更规范的框架作为约束，提高团队的姿势水平。
同期市面上可以做选择的有：阿里的eggjs，360的thinkjs，nestjs。

在刚开始接触nestjs的时候，本着对node和框架的理解，第一眼觉得是它了。天然TypeScript加持，IOC容器，元数据编程，依赖注入，这不就是js版本的spring嘛。
不过nestjs关注度还比较低，文档也较为简单，缺乏中文文档的支持，当然这都不是事。

## 框架比较，这里只介绍egg和nest

### eggjs的特点

1. 微内核 + 插件机制，这一直是架构中提升扩展性和组织代码的的一种方式。将变化的功能从核心系统生命周期中剥离，达到了解耦和降低框架复杂度的目的

2. 通过自动挂载代码/服务到内置对象的方式解决了项目中模块之间引用的问题，不在需要大规模手动维护模块之间的依赖关系。其核心就是一个loader

3. 强制约束，约定优于配置。规范了开发过程中，目录的组织结构和代码风格

4. 内置了cluster，Master作为守护进程，Agent作为代理进程，fork多个woker处理业务。充分利用了cpu的多核效率，同时部署不在依赖pm2这样的进程管理工具

5. 文档比较全面，沉淀时间较长，良好的社区支持

### nestjs的特点

1. 内置IOC容器，通过依赖注入组件树的方式解决模块之间的依赖关系，组织逻辑非常清晰

2. 需要手动组织各个根模块之间的依赖，强制约束。业务模块之间完全解耦，可支持业务模块插拨式组织代码

3. 在流程上抽象出了filter、pipe、guard、interceptor这些概念，将业务中的一些操作明晰化

4. 内置微服务，swagger，以及比较新颖的Rxjs操作事件流等

5. 大量使用装饰器，将部分数据流逻辑和业务逻辑解耦，业务逻辑更加清晰但是增加了代码的复杂度

6. 文档简单，缺少最佳实践，社区支持较差，摸着石头过河

7. 路由，模块，方法级别的中间件，增加了中间件使用的灵活性

两个框架本质上都解决了*代码结构强约束，不需要手动维护模块关系，扩展性强*

## nestjs一些概念的理解
nestjs在理解上，有太多对node来说比较新颖的概念，一些是对js语言新特性的实践，一些已经在后端领域已经沉淀多年，在node框架中引入还是第一次。
不过我相信所有的技术都是趋同的，合理的东西会被保留，相互模仿，并且变得同质化。

### js语言新特性的运用
1. ES6的proxy，reflect

2. TypeScript的decorator

3. 通过decorator和元数据实现依赖注入

### 后端沉淀的运用
1. IOC容器

2. RxJS操作事件流

3. 元数据编程

## 最后框架的选择
其实我觉得eggjs和nestjs都可以满足我作为团队Node框架的选择。
就业务快速落地的角度来说，我偏向于eggjs。
但我们更应该着眼未来，语言新特性的应用，后端概念的沉淀和趋同。毕竟人生需要折腾，我选择nestjs。

附上我折腾的demo： [nestjs-demo](https://github.com/soulmate2015/nestjs-demo)